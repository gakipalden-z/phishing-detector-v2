{% extends 'base.html' %}
{% block content %}
<h1>Dashboard</h1>
<p class="muted">Welcome, <strong>{{ current_user.username }}</strong> (role: {{ current_user.role }}).</p>
<div class="grid">
  <div class="card">
    <h2>Quick actions</h2>
    <ul>
      <li><a href="{{ url_for('dashboard.analyze') }}">Analyze a new email</a></li>
      <li><a href="{{ url_for('auth.mfa_setup') }}">Enable / view 2FA setup</a></li>
      <li><a href="{{ url_for('dashboard.export_csv') }}">Export my analysis history (CSV)</a></li>
    </ul>
  </div>
  <div class="card">
    <h2>Recent analyses</h2>
    {% if items %}
      <table>
        <thead><tr><th>ID</th><th>Time</th><th>Risk</th><th>Score</th><th>Quarantine</th></tr></thead>
        <tbody>
        {% for it in items %}
          <tr>
            <td><a href="{{ url_for('dashboard.result', analysis_id=it.id) }}">{{ it.id }}</a></td>
            <td>{{ it.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ it.risk_level }}</td>
            <td>{{ it.risk_score }}</td>
            <td>{{ 'Yes' if it.quarantined else 'No' }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No analyses yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
